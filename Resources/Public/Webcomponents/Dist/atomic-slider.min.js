export default class AtomicSlider extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.render(),this.onSwipeStart=this.onSwipeStart.bind(this),this.onSwipeEnd=this.onSwipeEnd.bind(this),this.onDrag=this.onDrag.bind(this),this.time=this.getAttribute("time")?this.getAttribute("time"):"3s",this.currentSlideNum=0,this.latestSelectedSlide=null,this.timeMs=this._parseTimeStringToMilliSeconds(this.time),this.dotNavState=!1,this.addEventListener("mousedown",this.onSwipeStart,{passive:!0}),this.addEventListener("touchstart",this.onSwipeStart,{passive:!0}),this.addEventListener("mousemove",this.onDrag,{passive:!0}),this.addEventListener("touchmove",this.onDrag,{passive:!0}),this.addEventListener("mouseup",this.onSwipeEnd,{passive:!0}),this.addEventListener("touchend",this.onSwipeEnd,{passive:!0}),this.slideChange=new CustomEvent("atomic-slider-slided",{detail:{message:"atomic-slider has slided"},bubbles:!0,composed:!0})}connectedCallback(){this.render(),this.initPrevNextButtons(),this.shadowRoot.querySelector(".slides slot").addEventListener("slotchange",t=>{this.initSlider(),this._goToSlide(0),this.initNavDots()}),this.loadingAnim=this.loadingbar,this.startInterval()}get disablePrevNext(){return this.getAttribute("disablePrevNext")}get totalAmountOfSlides(){return this.slides.length}get prevBt(){return this.querySelector('atomic-slider-prevnext-button[data-action="move-backwards"]')}get nextBt(){return this.querySelector('atomic-slider-prevnext-button[data-action="move-forward"]')}get slides(){return this.defaultSlot.assignedElements()}get loadingbar(){return this.shadowRoot.querySelector("atomic-loadingbar")}get navDots(){return this.shadowRoot.querySelectorAll("atomic-slider-dotnav-button")}get defaultSlot(){return this.shadowRoot.querySelector(".slides > slot")}get currentSlide(){let t=this.currentSlideNum?this.currentSlideNum:0;return this.querySelector(":scope > *[data-num='"+t+"']")}get targetNavDots(){return this.getAttribute("targetNavDots")}get disableNavDots(){return this.hasAttribute("disableNavDots")}get predefinedNavDots(){if(!this.targetNavDots)return[];let t;return 0===(t=document.querySelectorAll(this.targetNavDots+"> *")).length&&console.error("Atomic-Slider: targetNavDots is set, but can't find the element. Please check if the element exists."),t}get swipeMode(){return this.getAttribute("swipeMode")}startDragging(){this.dragging=!0}preventDragging(){this.dragging=!1}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i)}_parseTimeStringToMilliSeconds(t){return null===t||""===t?1e4:!0===t.includes("ms")?t.replace("ms",""):!0===t.includes("s")?1e3*t.replace("s",""):1e4}_dispatchSlideChange(){let t=new CustomEvent("atomic-slider-slided",{detail:{message:"atomic-slider has slided"},bubbles:!0,composed:!0});this.dispatchEvent(t)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("mousedown",this.onSwipeStart),this.removeEventListener("touchstart",this.onSwipeStart),this.removeEventListener("mousemove",this.onDrag),this.removeEventListener("touchmove",this.onDrag),this.removeEventListener("mouseup",this.onSwipeEnd),this.removeEventListener("touchend",this.onSwipeEnd)}initPrevNextButtons(){!this.disablePrevNext&&this.prevBt&&this.nextBt&&(this.prevBt.removeEventListener("click",()=>{}),this.prevBt.addEventListener("click",()=>{this.goToPreviousSlide()}),this.prevBt.addEventListener("mouseover",()=>{this.preventDragging()}),this.prevBt.addEventListener("mouseout",()=>{this.startDragging()}),this.nextBt.removeEventListener("click",()=>{}),this.nextBt.addEventListener("click",()=>{this.goToNextSlide()}),this.nextBt.addEventListener("mouseover",()=>{this.preventDragging()}),this.nextBt.addEventListener("mouseout",()=>{this.startDragging()}))}resetInterval(){clearInterval(this.interval),this.startInterval(),void 0!==this.loadingAnim&&this._startLoadingAnim()}startInterval(){this.interval=setInterval(()=>{this.goToNextSlide()},this.timeMs)}initNavDots(){if(this.disableNavDots||this.targetNavDots)if(this.predefinedNavDots)this.predefinedNavDots.forEach((t,e)=>{let i=t.getAttribute("data-num");t.setAttribute("aria-selected",!0),t.classList.add("active"),t.setAttribute("role","tab"),t.setAttribute("aria-controls",this.uuid+e),t.addEventListener("click",()=>{this._goToSlide(parseInt(i))})});else{(t=this.shadowRoot.querySelector(".nav-dots")).setAttribute("hidden",1)}else{this.uuid=this.create_UUID();const e=this.slides;var t;if((t=this.shadowRoot.querySelector(".nav-dots")).innerHTML="",!(e.length>1))return;this.dotNavState=!0,e.forEach((e,i)=>{this.uuid=this.create_UUID();var s=document.createElement("li");s.setAttribute("data-num",i);var n=document.createElement("atomic-slider-dotnav-button");n.setAttribute("data-num",i),n.setAttribute("aria-selected",!1),n.setAttribute("role","tab"),n.setAttribute("aria-controls",this.uuid+i),n.addEventListener("click",()=>{this._goToSlide(i)}),0===i&&(n.setAttribute("aria-selected",!0),n.classList.add("active")),s.appendChild(n),t.appendChild(s)})}}create_UUID(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)})}onSwipeStart(t){this.dragInit=t.clientX||t.changedTouches[0].clientX}onDrag(t){if(this.dragInit&&this.dragging&&"swipe"===this.swipeMode){this.pauseSlider();const e=(t.clientX||t.changedTouches[0].clientX)-this.dragInit;this.slides.forEach(t=>{switch(t.style.transition="none","true"){case t.getAttribute("next"):t.style.left=`${t.offsetWidth+e}px`;break;case t.getAttribute("previous"):t.style.left=`${-t.offsetWidth+e}px`;break;default:t.style.left=`${e}px`}})}}onSwipeEnd(t){if(null==t.changedTouches&&!t.clientX&&"swipe"!==this.swipeMode)return!1;this.dragEnd=t.clientX||t.changedTouches[0].clientX,this.dragInit-this.dragEnd>10?this.goToNextSlide():this.dragEnd-this.dragInit>10&&this.goToPreviousSlide(),this.slides.forEach(t=>{t.style.left=0,t.style.transition=null}),[this.dragInit,this.dragEnd]=[0,0],this.initSlider()}initSlider(){this.slides.forEach((t,e)=>{t.setAttribute("data-num",e)}),this.setAttribute("initialized","")}pauseSlider(){clearTimeout(this.interval),this.interval=null}goToNextSlide(){const t=this.totalAmountOfSlides-1===this.currentSlideNum?0:this.currentSlideNum+1;this._goToSlide(t)}_onSlotchange(){this.initSlider()}_startLoadingAnim(){0===this.predefinedNavDots.length&&this.loadingAnim&&"function"==typeof this.loadingAnim.restart&&this.loadingAnim.restart()}goToPreviousSlide(){const t=0===this.currentSlideNum?this.totalAmountOfSlides-1:this.currentSlideNum-1;this._goToSlide(t)}_goToSlide(t){this._setIndividualTime(t),this.resetInterval(),this.selectSlide(t),this.dispatchEvent(this.slideChange)}_setIndividualTime(t){let e=this.currentSlide.getAttribute("time");this.timeMs=null===e||""===e?this._parseTimeStringToMilliSeconds(this.time):this._parseTimeStringToMilliSeconds(e)}_onAnimEnd(){this.currentSlide.removeAttribute("before"),this.currentSlide.removeEventListener("animationend",this.onAnimEnd.bind(this))}selectSlide(t){this.slides.forEach((t,e)=>{t.removeAttribute("before")}),this.currentSlide.setAttribute("before",!0),this.slides.forEach((e,i)=>{e.setAttribute("selected",i===t),e.setAttribute("previous",i===(0===t?this.totalAmountOfSlides-1:t-1)),e.setAttribute("next",i===(this.totalAmountOfSlides-1===t?0:t+1)),i===t&&e.addEventListener("animationend",this._onAnimEnd.bind(this)),null!=this.navDots&&this.navDots.forEach((e,i)=>{e.setAttribute("aria-selected","false"),e.classList.remove("active"),i===t&&(e.setAttribute("aria-selected","true"),e.classList.add("active"))})}),this.currentSlideNum=t}render(){this.shadowRoot.innerHTML=`  \n        <slot name="previous-next" class='${!0===this.disablePrevNext?"hidden":""} '></slot>\n        \n        <div class="slides" part="slides">\n            <slot @slotchange="${this._onSlotchange}"></slot>        \n        </div>\n        ${this.predefinedNavDots}\n        <div class="nav-dot-wrapper ${!0===this.disableNavDots||this.predefinedNavDots.length>0?"hidden":""}" part="nav-dot-wrapper">\n            <ul class="nav-dots" part="nav-dots">Dot-Navigation: no slides found</ul>\n            <atomic-loadingbar time="${this.timeMs}" begin></atomic-loadingbar>\n        </div>\n        \n        <style>\n        :host {\n          box-sizing: content-box;\n          transition: all .5s ease-in-out;\n          position: relative;\n          overflow: var(--atomic-slider-overflow, hidden);\n          display:none;\n          padding-bottom: var(--atomic-slider-bottom-spacing,0px);\n          background-color:var(--atomic-slider-background-color,transparent);\n        }\n        :host([initialized]){\n          display:block;\n        }\n        .nav-dot-wrapper{\n          position:absolute;\n          z-index:1;\n          bottom: var(--atomic-slider-navdots-bottom,0px);\n          margin:0;\n          padding:10px 0px;\n          left:50%;\n          transform:translateX(-50%);\n        }\n        .nav-dots{\n          margin:0;\n          padding:0;\n          display:flex;\n          align-items: center;\n          list-style-type:none;\n        }\n        \n        atomic-loadingtime{\n          position:absolute;\n          top:60px;\n        }\n        \n        :host([nav-dots-top]) .nav-dot-wrapper{\n           bottom:auto;\n           top:0;\n        }\n        .nav-dots li atomic-slider-dotnav-button{\n          position:relative;\n        }\n        .nav-dots li:last-child atomic-slider-dotnav-button{\n          --atomic-slider-dotnav-button-margin:0;\n        }\n        atomic-loadingbar{\n          margin-top:10px;\n        }\n        \n        :host .slides{\n          position: relative;\n          z-index: 0;\n          margin: 0 var(--atomic-slider-marginleftright,0px);\n        }\n        :host{\n          margin: var(--atomic-slider-margin,0px);\n        }\n  \n        atomic-slider-prevnext-button[data-action="move-forward"] {\n          transform: rotate(180deg);\n          left: calc(100% - var(--atomic-slider-marginleftright,40px));\n        }\n        .hidden{\n          display:none;\n        }\n        ::slotted(*:not([slot])) {\n            display:block;\n            top:0;\n            left:0;\n            width:100%;\n            height:100%;\n            opacity: 0;\n            transition: opacity var(--atomic-slider-transition-time, 1s) var(--atomic-slider-transition, ease-in-out), left var(--atomic-slider-transition-time, 1s) var(--atomic-slider-transition, ease-in-out);\n            position:absolute;\n        }\n\n        :host([slideMode="slide"]) ::slotted(*[next="true"]) {\n          left: 100% !important;\n        }\n\n        :host([slideMode="slide"]) ::slotted(*[previous="true"]) {\n          left: -100% !important;\n        }\n        \n        ::slotted([selected="true"]) {\n            position: relative !important;\n            z-index: 1;\n            opacity: 1 !important;\n            visibility: visible !important;\n        }\n        \n      </style>\n      `}}customElements.get("atomic-slider")||customElements.define("atomic-slider",AtomicSlider);